# Use the buildkit syntax to pass build arguments
#syntax=docker/dockerfile:1

# Start from the official Minecraft server image
FROM itzg/minecraft-server:latest

# Set environment variables that are needed to pre-install the server
ENV EULA="TRUE"
ENV TYPE="PAPER"
ENV VERSION="1.20.1"

# Use the --dns flag within the RUN command, which is enabled by BuildKit.
# This forces the use of Google's DNS for this specific command.
RUN --mount=type=cache,target=/var/cache/apt \
    --network=default \
    --dns=8.8.8.8 \
    /usr/local/bin/install-paper

# Unset the installer variables so they don't conflict with runtime.
ENV TYPE=""
ENV VERSION=""